package com.amaz.onib;

import android.app.PendingIntent;
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.telephony.gsm.SmsManager;
import com.amaz.onib.cu;
import com.jy.utils.BaseHttpThreadV2;
import com.yuanlang.pay.plugin.libs.x;
import java.util.Timer;
import java.util.TimerTask;
/* loaded from: classes.dex */
public class cv implements cu.c {

    /* renamed from: a  reason: collision with root package name */
    private static int f720a;
    private Context b;
    private cp c;
    private cr d;
    private BroadcastReceiver e;
    private BroadcastReceiver f;
    private Timer g;

    /* JADX INFO: Access modifiers changed from: package-private */
    /* loaded from: classes.dex */
    public class a extends BroadcastReceiver {
        a() {
        }

        @Override // android.content.BroadcastReceiver
        public void onReceive(Context context, Intent intent) {
            if (intent.getAction().equals("DELIVERED_SMS_ACTION_ORDER")) {
                cv.this.d.a("收信人已经成功接收订购短信");
                return;
            }
            cv.this.d.a("收信人已经成功接收验证短信");
            cv.this.b.unregisterReceiver(cv.this.f);
        }
    }

    /* JADX INFO: Access modifiers changed from: package-private */
    /* loaded from: classes.dex */
    public class b extends TimerTask {

        /* renamed from: a  reason: collision with root package name */
        int f722a;

        public b(int i) {
            this.f722a = i;
        }

        @Override // java.util.TimerTask, java.lang.Runnable
        public void run() {
            Intent intent = new Intent();
            if (this.f722a == 1) {
                intent.setAction("SENT_SMS_ACTION_ORDER");
            } else {
                intent.setAction("SENT_SMS_ACTION_VERIFY");
            }
            cv.this.b.sendOrderedBroadcast(intent, null, cv.this.e, null, 2237, null, null);
        }
    }

    /* JADX INFO: Access modifiers changed from: package-private */
    /* loaded from: classes.dex */
    public class c extends BroadcastReceiver {

        /* renamed from: a  reason: collision with root package name */
        int f723a;

        c() {
        }

        @Override // android.content.BroadcastReceiver
        public void onReceive(Context context, Intent intent) {
            if (intent.getAction().equals("SENT_SMS_ACTION_VERIFY")) {
                cv.this.b.unregisterReceiver(cv.this.e);
            }
            switch (getResultCode()) {
                case BaseHttpThreadV2.PostFail /* -1 */:
                    if (intent.getAction().equals("SENT_SMS_ACTION_ORDER")) {
                        cv.this.d.a("订购短信发送成功");
                        if (cv.this.c.e()) {
                            cu cuVar = new cu(cv.this.b, cv.this.c);
                            cuVar.a(cv.this);
                            cuVar.show();
                        }
                    } else {
                        cv.this.d.a("验证短信发送成功");
                        cv.this.d.a();
                    }
                    if (cv.this.g != null) {
                        cv.this.g.cancel();
                    }
                    cw.a(cv.this.b).a();
                    return;
                case 1:
                case 2:
                case 3:
                    this.f723a = 9993;
                    if (cv.this.g != null) {
                        cv.this.g.cancel();
                    }
                    if (intent.getAction().equals("SENT_SMS_ACTION_ORDER")) {
                        cv.this.d.a(this.f723a, "订购短信发送失败");
                    } else {
                        cv.this.d.a(this.f723a, "验证短信发送失败");
                    }
                    cw.a(cv.this.b).a();
                    return;
                case 2237:
                    this.f723a = 2237;
                    if (intent.getAction().equals("SENT_SMS_ACTION_ORDER")) {
                        cv.this.d.a(this.f723a, "订购短信发送超时");
                    } else {
                        cv.this.d.a(this.f723a, "验证短信发送超时");
                    }
                    cw.a(cv.this.b).a();
                    return;
                default:
                    return;
            }
        }
    }

    public cv(Context context, cp cpVar, cr crVar) {
        this.b = context;
        this.c = cpVar;
        this.d = crVar;
        e();
    }

    private void a(int i) {
        if (this.g != null) {
            this.g.cancel();
        }
        this.g = new Timer();
        this.g.schedule(new b(i), x.d);
    }

    private void a(PendingIntent pendingIntent, PendingIntent pendingIntent2, String str, String str2) {
        SmsManager smsManager = SmsManager.getDefault();
        for (String str3 : smsManager.divideMessage(str)) {
            smsManager.sendTextMessage(str2, null, str3, pendingIntent, pendingIntent2);
        }
    }

    private void e() {
        this.e = new c();
        this.f = new a();
    }

    private PendingIntent f() {
        Intent intent = new Intent("SENT_SMS_ACTION_ORDER");
        Context context = this.b;
        int i = f720a;
        f720a = i + 1;
        return PendingIntent.getBroadcast(context, i, intent, 134217728);
    }

    private PendingIntent g() {
        Intent intent = new Intent("SENT_SMS_ACTION_VERIFY");
        Context context = this.b;
        int i = f720a;
        f720a = i + 1;
        return PendingIntent.getBroadcast(context, i, intent, 134217728);
    }

    private PendingIntent h() {
        Intent intent = new Intent("DELIVERED_SMS_ACTION_ORDER");
        Context context = this.b;
        int i = f720a;
        f720a = i + 1;
        return PendingIntent.getBroadcast(context, i, intent, 134217728);
    }

    private PendingIntent i() {
        Intent intent = new Intent("DELIVERED_SMS_ACTION_VERIFY");
        Context context = this.b;
        int i = f720a;
        f720a = i + 1;
        return PendingIntent.getBroadcast(context, i, intent, 134217728);
    }

    @Override // com.amaz.onib.cu.c
    public void a() {
        this.d.a(9991, "用户取消");
        this.b.unregisterReceiver(this.e);
        this.b.unregisterReceiver(this.f);
    }

    @Override // com.amaz.onib.cu.c
    public void b() {
        d();
    }

    public void c() {
        IntentFilter intentFilter = new IntentFilter();
        intentFilter.addAction("SENT_SMS_ACTION_ORDER");
        intentFilter.addAction("SENT_SMS_ACTION_VERIFY");
        this.b.registerReceiver(this.e, intentFilter);
        IntentFilter intentFilter2 = new IntentFilter();
        intentFilter2.addAction("DELIVERED_SMS_ACTION_ORDER");
        intentFilter2.addAction("DELIVERED_SMS_ACTION_VERIFY");
        this.b.registerReceiver(this.f, intentFilter2);
        a(1);
        a(f(), h(), this.c.p(), "106566660020");
    }

    public void d() {
        a(2);
        a(g(), i(), this.c.d(), "106566660020");
    }
}
