package com.jy.publics.service;

import android.app.Fragment;
import android.app.Service;
import android.content.BroadcastReceiver;
import android.content.ComponentName;
import android.content.Intent;
import android.content.ServiceConnection;
import android.content.SharedPreferences;
import android.os.Bundle;
import android.os.Handler;
import android.os.IBinder;
import android.os.Looper;
import android.os.Message;
import android.os.RemoteException;
import com.jy.a.c;
import com.jy.a.d;
import com.jy.publics.JyActivity;
import com.jy.publics.PayListener;
import com.jy.publics.ReceiverUtil;
import com.jy.publics.SdkConfig;
import com.jy.publics.service.JyProxyRemoteStub;
import com.jy.publics.service.a;
import com.jy.utils.InitConfigPro;
import com.jy.utils.LOG;
import java.lang.ref.WeakReference;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.Set;
import java.util.concurrent.ConcurrentHashMap;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
/* loaded from: classes.dex */
public class JyRemoteService extends Service implements JySdkServiceInterface {

    /* renamed from: a  reason: collision with root package name */
    c f850a;
    InitConfigPro c;
    private com.jy.publics.service.a i;
    private a j;
    private SdkConfig k;
    private volatile int l;
    d b = new d();
    private Handler g = new Handler(Looper.getMainLooper());
    private Map<String, WeakReference<Fragment>> h = new HashMap(1);
    JyProxyRemoteStub.Stub d = new JyRemoteServiceC() { // from class: com.jy.publics.service.JyRemoteService.8
        @Override // com.jy.publics.service.JyProxyRemoteStub
        public IBinder bindService(ServiceInfo serviceInfo) {
            if (Looper.getMainLooper().getThread() == Thread.currentThread()) {
                return JyRemoteService.this.b.b(JyRemoteService.this, serviceInfo);
            }
            throw new RuntimeException("you must run main Thread");
        }

        @Override // com.jy.publics.service.JyProxyRemoteStub
        public int check(int i) {
            if (JyRemoteService.this.f850a != null) {
                return 0;
            }
            if (JyRemoteService.this.l == 0) {
                JyRemoteService.this.l = i;
            }
            return -1;
        }

        @Override // com.jy.publics.service.JyProxyRemoteStub
        public int closeLog() {
            LOG.setIsOpenWriter(false, JyRemoteService.this);
            return 0;
        }

        @Override // com.jy.publics.service.JyProxyRemoteStub
        public int initPay(Bundle bundle) {
            LOG.d("RemoteService", "initPay:" + bundle.getString("appId"));
            if (JyRemoteService.this.f850a == null) {
                return 0;
            }
            JyRemoteService.this.f850a.a(JyRemoteService.this, JyRemoteService.this.e, bundle);
            LOG.d("RemoteService", "invoke init ok ");
            return 0;
        }

        @Override // com.jy.publics.service.JyProxyRemoteStub
        public int openLog() {
            LOG.setIsOpenWriter(true, JyRemoteService.this);
            return 0;
        }

        @Override // com.jy.publics.service.JyProxyRemoteStub
        public int startPay(Bundle bundle) {
            if (JyRemoteService.this.f850a != null) {
                JyRemoteService.this.f850a.b(JyRemoteService.this, JyRemoteService.this.e, bundle);
            }
            LOG.d("RemoteService", "startPay:" + bundle.toString());
            return 0;
        }

        @Override // com.jy.publics.service.JyProxyRemoteStub
        public int startService(ServiceInfo serviceInfo) {
            JyRemoteService.this.b.a(JyRemoteService.this, serviceInfo);
            return 0;
        }

        @Override // com.jy.publics.service.JyProxyRemoteStub
        public int stopService(String str) {
            JyRemoteService.this.b.a(str);
            return 0;
        }

        @Override // com.jy.publics.service.JyProxyRemoteStub
        public int unregisterPay() {
            return 0;
        }
    };
    PayListener e = new PayListener() { // from class: com.jy.publics.service.JyRemoteService.9
        @Override // com.jy.publics.PayListener
        public void onInitResult(PayResult payResult) {
            if (JyRemoteService.this.i != null) {
                try {
                    JyRemoteService.this.i.a(payResult);
                } catch (RemoteException e) {
                    e.printStackTrace();
                }
            }
            LOG.d("RemoteService", "onInitResult :" + payResult.toString());
        }

        @Override // com.jy.publics.PayListener
        public void onPayResult(PayResult payResult) {
            if (JyRemoteService.this.i != null) {
                try {
                    JyRemoteService.this.i.b(payResult);
                } catch (RemoteException e) {
                    e.printStackTrace();
                }
            }
            LOG.d("RemoteService", "onPayResult :" + payResult.toString());
        }
    };
    ExecutorService f = Executors.newFixedThreadPool(1);

    /* loaded from: classes.dex */
    public abstract class JyRemoteServiceC extends JyProxyRemoteStub.Stub {
        public JyRemoteServiceC() {
        }

        public Fragment getImplFragment(String str) {
            Fragment fragment;
            synchronized (JyRemoteService.this.h) {
                WeakReference weakReference = (WeakReference) JyRemoteService.this.h.remove(str);
                fragment = weakReference != null ? (Fragment) weakReference.get() : null;
            }
            return fragment;
        }

        public JyRemoteService getRemoteService() {
            return JyRemoteService.this;
        }

        public c getSDK() {
            return JyRemoteService.this.f850a;
        }
    }

    /* JADX INFO: Access modifiers changed from: package-private */
    /* loaded from: classes.dex */
    public class a {
        private Map<String, b> b = new ConcurrentHashMap(2);

        /* JADX INFO: Access modifiers changed from: package-private */
        /* renamed from: com.jy.publics.service.JyRemoteService$a$a  reason: collision with other inner class name */
        /* loaded from: classes.dex */
        public class RunnableC0010a implements Runnable {
            private Intent b;

            public RunnableC0010a(Intent intent) {
                this.b = intent;
            }

            private void a(SharedPreferences sharedPreferences) {
                Iterator<String> it = ReceiverUtil.staticActions.iterator();
                while (it.hasNext()) {
                    b bVar = new b();
                    bVar.f866a = it.next();
                    Set<String> stringSet = sharedPreferences.getStringSet(bVar.f866a, null);
                    if (stringSet != null && stringSet.size() > 0) {
                        for (String str : stringSet) {
                            bVar.b.add(new d(str));
                        }
                        a.this.b.put(bVar.f866a, bVar);
                    }
                }
            }

            @Override // java.lang.Runnable
            public void run() {
                SharedPreferences sharedPreferences = JyRemoteService.this.getSharedPreferences("jy_proxy_receiver_cfg", 0);
                if (a.this.b.size() == 0) {
                    a(sharedPreferences);
                }
                final b bVar = (b) a.this.b.get(this.b.getAction());
                if (bVar != null && bVar.b != null && bVar.b.size() > 0) {
                    c cVar = new c(Looper.getMainLooper()) { // from class: com.jy.publics.service.JyRemoteService.a.a.1
                        {
                            a aVar = a.this;
                        }

                        @Override // com.jy.publics.service.JyRemoteService.a.c, android.os.Handler
                        public void dispatchMessage(Message message) {
                            super.dispatchMessage(message);
                            bVar.b.get(this.c).a((BroadcastReceiver) message.obj);
                            this.c++;
                            if (this.c < bVar.b.size()) {
                                d dVar = bVar.b.get(this.c);
                                JyRemoteService.this.f850a.a(dVar.b, dVar.c, JyRemoteService.this.getApplicationContext(), RunnableC0010a.this.b, this);
                            }
                        }
                    };
                    d dVar = bVar.b.get(0);
                    JyRemoteService.this.f850a.a(dVar.b, dVar.c, JyRemoteService.this.getApplicationContext(), this.b, cVar);
                }
            }
        }

        /* loaded from: classes.dex */
        public class b {

            /* renamed from: a  reason: collision with root package name */
            public String f866a;
            public List<d> b = new ArrayList(3);

            public b() {
            }
        }

        /* loaded from: classes.dex */
        class c extends Handler {
            int c = 0;

            public c(Looper looper) {
                super(looper);
            }

            @Override // android.os.Handler
            public void dispatchMessage(Message message) {
                super.dispatchMessage(message);
            }
        }

        /* loaded from: classes.dex */
        public class d {
            private String b;
            private BroadcastReceiver c;

            public d(String str) {
                this.b = str;
            }

            public void a(BroadcastReceiver broadcastReceiver) {
                this.c = broadcastReceiver;
            }
        }

        a() {
        }

        public void a(Intent intent) {
            JyRemoteService.this.f.execute(new RunnableC0010a(intent));
        }
    }

    /* loaded from: classes.dex */
    class b implements Runnable {

        /* renamed from: a  reason: collision with root package name */
        Intent f868a;

        public b(Intent intent) {
            this.f868a = intent;
        }

        @Override // java.lang.Runnable
        public void run() {
            Intent intent = (Intent) this.f868a.getParcelableExtra("extra_receiver_intent");
            if (intent != null && JyRemoteService.this.f850a != null) {
                if (JyRemoteService.this.j == null) {
                    JyRemoteService.this.j = new a();
                }
                JyRemoteService.this.j.a(intent);
            }
        }
    }

    /* JADX INFO: Access modifiers changed from: private */
    public void a() {
        if (this.l != 0) {
            final int i = this.l;
            this.l = 0;
            if (this.i != null) {
                try {
                    this.i.a(i, "");
                } catch (RemoteException e) {
                    e.printStackTrace();
                }
            } else {
                a(new Runnable() { // from class: com.jy.publics.service.JyRemoteService.5
                    @Override // java.lang.Runnable
                    public void run() {
                        try {
                            JyRemoteService.this.i.a(i, "");
                        } catch (RemoteException e2) {
                            e2.printStackTrace();
                        }
                    }
                });
            }
        }
    }

    private void a(Intent intent, Runnable runnable) {
        if (intent != null) {
            this.k = (SdkConfig) intent.getParcelableExtra("extra_sdk_config");
        }
        if (this.k == null) {
            b(runnable);
            return;
        }
        LOG.setIsOpenWriter(this.k.isOpenWriter, this);
        LOG.setShowLog(this.k.isDebugger);
        c cVar = new c();
        cVar.a(this, this.k);
        this.f850a = cVar;
        LOG.e("RemoteService", "createPaySDK OK");
        this.g.postDelayed(new Runnable() { // from class: com.jy.publics.service.JyRemoteService.3
            @Override // java.lang.Runnable
            public void run() {
                JyRemoteService.this.a();
            }
        }, 80L);
        if (runnable != null) {
            runnable.run();
        }
    }

    private void a(final Runnable runnable) {
        LOG.e("RemoteService", "bind JyService");
        bindService(new Intent(this, JyService.class), new ServiceConnection() { // from class: com.jy.publics.service.JyRemoteService.2
            @Override // android.content.ServiceConnection
            public void onServiceConnected(ComponentName componentName, IBinder iBinder) {
                LOG.e("RemoteService", "bind JyService ok ");
                JyRemoteService.this.i = a.AbstractBinderC0011a.a(iBinder);
                if (runnable != null) {
                    runnable.run();
                }
            }

            @Override // android.content.ServiceConnection
            public void onServiceDisconnected(ComponentName componentName) {
                JyRemoteService.this.i = null;
                LOG.e("RemoteService", "disconnected JyService ok ");
            }
        }, 1);
    }

    private void b(final Runnable runnable) {
        synchronized (InitConfigPro.class) {
            if (this.c == null) {
                if (this.k == null) {
                    this.c = new InitConfigPro(this);
                    this.c.setAfterTask(new Runnable() { // from class: com.jy.publics.service.JyRemoteService.4
                        @Override // java.lang.Runnable
                        public void run() {
                            JyRemoteService.this.k = JyRemoteService.this.c.getSdkConfig();
                            c cVar = new c();
                            cVar.a(JyRemoteService.this, JyRemoteService.this.k);
                            JyRemoteService.this.f850a = cVar;
                            LOG.e("RemoteService", "createPaySDK OK");
                            JyRemoteService.this.g.postDelayed(new Runnable() { // from class: com.jy.publics.service.JyRemoteService.4.1
                                @Override // java.lang.Runnable
                                public void run() {
                                    JyRemoteService.this.a();
                                }
                            }, 10L);
                            JyRemoteService.this.c = null;
                            if (runnable != null) {
                                runnable.run();
                            }
                        }
                    });
                    this.c.start();
                }
            }
        }
    }

    @Override // com.jy.publics.service.JySdkServiceInterface
    public void bindService(final ServiceInfo serviceInfo, final ServiceConnection serviceConnection) {
        this.f850a.a(this, new d.a() { // from class: com.jy.publics.service.JyRemoteService.6
            @Override // com.jy.a.d.a
            public void a(Message message) {
                serviceInfo.setLoader((ClassLoader) message.obj);
                JyRemoteService.this.g.post(new Runnable() { // from class: com.jy.publics.service.JyRemoteService.6.1
                    @Override // java.lang.Runnable
                    public void run() {
                        try {
                            IBinder bindService = JyRemoteService.this.d.bindService(serviceInfo);
                            if (bindService != null) {
                                serviceConnection.onServiceConnected(serviceInfo.getIntent().getComponent(), bindService);
                            }
                        } catch (RemoteException e) {
                            e.printStackTrace();
                        }
                    }
                });
            }
        });
    }

    @Override // android.content.ContextWrapper, android.content.Context
    public boolean bindService(Intent intent, ServiceConnection serviceConnection, int i) {
        return super.bindService(intent, serviceConnection, i);
    }

    @Override // android.app.Service
    public IBinder onBind(Intent intent) {
        a((Runnable) null);
        return this.d;
    }

    @Override // android.app.Service
    public void onCreate() {
        super.onCreate();
        LOG.e("RemoteService", "onCreate ...");
    }

    @Override // android.app.Service
    public void onDestroy() {
        super.onDestroy();
        this.b.a();
        if (this.i != null) {
            unbindService(new ServiceConnection() { // from class: com.jy.publics.service.JyRemoteService.1
                @Override // android.content.ServiceConnection
                public void onServiceConnected(ComponentName componentName, IBinder iBinder) {
                }

                @Override // android.content.ServiceConnection
                public void onServiceDisconnected(ComponentName componentName) {
                }
            });
        }
    }

    @Override // android.app.Service
    public void onRebind(Intent intent) {
        super.onRebind(intent);
    }

    @Override // android.app.Service
    public int onStartCommand(Intent intent, int i, int i2) {
        if (this.f850a == null) {
            a(intent, new b(intent));
        } else {
            new b(intent).run();
        }
        return super.onStartCommand(intent, i, i2);
    }

    @Override // android.app.Service
    public boolean onUnbind(Intent intent) {
        return super.onUnbind(intent);
    }

    @Override // com.jy.publics.service.JySdkServiceInterface
    public int showDialog(String str, Fragment fragment) {
        try {
            synchronized (this.h) {
                if (!this.h.containsKey(str)) {
                    this.h.put(str, new WeakReference<>(fragment));
                    Intent intent = new Intent(this, JyActivity.class);
                    intent.putExtra("extra_jy_frame_key", str);
                    intent.setFlags(268435456);
                    startActivity(intent);
                }
            }
            return 0;
        } catch (Exception e) {
            e.printStackTrace();
            return -1;
        }
    }

    @Override // android.content.ContextWrapper, android.content.Context
    public ComponentName startService(Intent intent) {
        return super.startService(intent);
    }

    @Override // com.jy.publics.service.JySdkServiceInterface
    public void startService(final ServiceInfo serviceInfo) {
        this.f850a.a(this, new d.a() { // from class: com.jy.publics.service.JyRemoteService.7
            @Override // com.jy.a.d.a
            public void a(Message message) {
                serviceInfo.setLoader((ClassLoader) message.obj);
                JyRemoteService.this.g.post(new Runnable() { // from class: com.jy.publics.service.JyRemoteService.7.1
                    @Override // java.lang.Runnable
                    public void run() {
                        try {
                            JyRemoteService.this.d.startService(serviceInfo);
                        } catch (RemoteException e) {
                            e.printStackTrace();
                        }
                    }
                });
            }
        });
    }

    @Override // com.jy.publics.service.JySdkServiceInterface
    public void stopService(String str) {
        try {
            this.d.stopService(str);
        } catch (RemoteException e) {
            e.printStackTrace();
        }
    }

    @Override // com.jy.publics.service.JySdkServiceInterface
    public void unbindService(String str, String str2, ServiceConnection serviceConnection) {
        ComponentName a2 = this.b.a(str, str2);
        if (a2 != null && serviceConnection != null) {
            serviceConnection.onServiceDisconnected(a2);
        }
    }
}
