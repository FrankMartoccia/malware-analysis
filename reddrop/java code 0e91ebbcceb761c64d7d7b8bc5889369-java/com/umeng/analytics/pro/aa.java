package com.umeng.analytics.pro;

import android.content.Context;
import android.content.SharedPreferences;
import com.umeng.analytics.AnalyticsConfig;
import java.io.File;
import org.json.JSONObject;
/* compiled from: Envelope.java */
/* loaded from: classes.dex */
public class aa {
    private String e;
    private int j;
    private int k;
    private byte[] l;
    private byte[] m;

    /* renamed from: a  reason: collision with root package name */
    private final byte[] f1040a = {0, 0, 0, 0, 0, 0, 0, 0};
    private final int b = 1;
    private final int c = 0;
    private String d = "1.0";
    private byte[] f = null;
    private byte[] g = null;
    private byte[] h = null;
    private int i = 0;
    private boolean n = false;

    private aa(byte[] bArr, String str, byte[] bArr2) throws Exception {
        this.e = null;
        this.j = 0;
        this.k = 0;
        this.l = null;
        this.m = null;
        if (bArr == null || bArr.length == 0) {
            throw new Exception("entity is null or empty");
        }
        this.e = str;
        this.k = bArr.length;
        this.l = bu.a(bArr);
        this.j = (int) (System.currentTimeMillis() / 1000);
        this.m = bArr2;
    }

    public static String a(Context context) {
        SharedPreferences a2 = ba.a(context);
        if (a2 == null) {
            return null;
        }
        return a2.getString("signature", null);
    }

    public void a(String str) {
        this.f = bt.a(str);
    }

    public String a() {
        return bt.a(this.f);
    }

    public void a(int i) {
        this.i = i;
    }

    public void a(boolean z) {
        this.n = z;
    }

    public static aa a(Context context, String str, byte[] bArr) {
        try {
            String q = bv.q(context);
            String c = bv.c(context);
            SharedPreferences a2 = ba.a(context);
            String string = a2.getString("signature", null);
            int i = a2.getInt("serial", 1);
            aa aaVar = new aa(bArr, str, (c + q).getBytes());
            aaVar.a(string);
            aaVar.a(i);
            aaVar.b();
            a2.edit().putInt("serial", i + 1).putString("signature", aaVar.a()).commit();
            aaVar.b(context);
            return aaVar;
        } catch (Exception e) {
            e.printStackTrace();
            return null;
        }
    }

    public static aa b(Context context, String str, byte[] bArr) {
        try {
            String q = bv.q(context);
            String c = bv.c(context);
            SharedPreferences a2 = ba.a(context);
            String string = a2.getString("signature", null);
            int i = a2.getInt("serial", 1);
            aa aaVar = new aa(bArr, str, (c + q).getBytes());
            aaVar.a(true);
            aaVar.a(string);
            aaVar.a(i);
            aaVar.b();
            a2.edit().putInt("serial", i + 1).putString("signature", aaVar.a()).commit();
            aaVar.b(context);
            return aaVar;
        } catch (Exception e) {
            e.printStackTrace();
            return null;
        }
    }

    public void b() {
        if (this.f == null) {
            this.f = d();
        }
        if (this.n) {
            byte[] bArr = new byte[16];
            try {
                System.arraycopy(this.f, 1, bArr, 0, 16);
                this.l = bt.a(this.l, bArr);
            } catch (Exception e) {
            }
        }
        this.g = a(this.f, this.j);
        this.h = e();
    }

    private byte[] a(byte[] bArr, int i) {
        byte[] b = bt.b(this.m);
        byte[] b2 = bt.b(this.l);
        int length = b.length;
        byte[] bArr2 = new byte[length * 2];
        for (int i2 = 0; i2 < length; i2++) {
            bArr2[i2 * 2] = b2[i2];
            bArr2[(i2 * 2) + 1] = b[i2];
        }
        for (int i3 = 0; i3 < 2; i3++) {
            bArr2[i3] = bArr[i3];
            bArr2[(bArr2.length - i3) - 1] = bArr[(bArr.length - i3) - 1];
        }
        byte[] bArr3 = {(byte) (i & 255), (byte) ((i >> 8) & 255), (byte) ((i >> 16) & 255), (byte) (i >>> 24)};
        for (int i4 = 0; i4 < bArr2.length; i4++) {
            bArr2[i4] = (byte) (bArr2[i4] ^ bArr3[i4 % 4]);
        }
        return bArr2;
    }

    private byte[] d() {
        return a(this.f1040a, (int) (System.currentTimeMillis() / 1000));
    }

    private byte[] e() {
        return bt.b((bt.a(this.f) + this.i + this.j + this.k + bt.a(this.g)).getBytes());
    }

    public byte[] c() {
        bq bqVar = new bq();
        bqVar.a(this.d);
        bqVar.b(this.e);
        bqVar.c(bt.a(this.f));
        bqVar.a(this.i);
        bqVar.c(this.j);
        bqVar.d(this.k);
        bqVar.a(this.l);
        bqVar.e(this.n ? 1 : 0);
        bqVar.d(bt.a(this.g));
        bqVar.e(bt.a(this.h));
        try {
            return new cp().a(bqVar);
        } catch (Exception e) {
            e.printStackTrace();
            return null;
        }
    }

    public void b(Context context) {
        String str = this.e;
        String g = af.a(context).b().g(null);
        String a2 = bt.a(this.f);
        byte[] bArr = new byte[16];
        System.arraycopy(this.f, 2, bArr, 0, 16);
        String a3 = bt.a(bt.b(bArr));
        try {
            JSONObject jSONObject = new JSONObject();
            jSONObject.put(x.f1213a, str);
            if (g != null) {
                jSONObject.put("umid", g);
            }
            jSONObject.put("signature", a2);
            jSONObject.put("checksum", a3);
            File file = new File(context.getFilesDir(), ".umeng");
            if (!file.exists()) {
                file.mkdir();
            }
            bw.a(new File(file, "exchangeIdentity.json"), jSONObject.toString());
        } catch (Throwable th) {
            th.printStackTrace();
        }
        try {
            JSONObject jSONObject2 = new JSONObject();
            jSONObject2.put(x.f1213a, str);
            jSONObject2.put(x.b, AnalyticsConfig.getChannel(context));
            if (g != null) {
                jSONObject2.put("umid", bw.b(g));
            }
            bw.a(new File(context.getFilesDir(), "exid.dat"), jSONObject2.toString());
        } catch (Throwable th2) {
            th2.printStackTrace();
        }
    }

    public String toString() {
        int i = 1;
        StringBuilder sb = new StringBuilder();
        sb.append(String.format("version : %s\n", this.d));
        sb.append(String.format("address : %s\n", this.e));
        sb.append(String.format("signature : %s\n", bt.a(this.f)));
        sb.append(String.format("serial : %s\n", Integer.valueOf(this.i)));
        sb.append(String.format("timestamp : %d\n", Integer.valueOf(this.j)));
        sb.append(String.format("length : %d\n", Integer.valueOf(this.k)));
        sb.append(String.format("guid : %s\n", bt.a(this.g)));
        sb.append(String.format("checksum : %s ", bt.a(this.h)));
        Object[] objArr = new Object[1];
        if (!this.n) {
            i = 0;
        }
        objArr[0] = Integer.valueOf(i);
        sb.append(String.format("codex : %d", objArr));
        return sb.toString();
    }
}
