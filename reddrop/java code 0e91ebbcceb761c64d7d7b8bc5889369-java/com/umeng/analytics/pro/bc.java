package com.umeng.analytics.pro;

import android.content.Context;
import android.content.SharedPreferences;
import android.text.TextUtils;
import android.util.Base64;
import com.umeng.analytics.AnalyticsConfig;
import com.umeng.analytics.a;
import com.umeng.analytics.pro.cc;
import com.umeng.analytics.pro.cy;
import java.io.File;
import java.io.FileInputStream;
import org.json.JSONObject;
/* compiled from: Sender.java */
/* loaded from: classes.dex */
public class bc {

    /* renamed from: a  reason: collision with root package name */
    private static final int f1075a = 1;
    private static final int b = 2;
    private static final int c = 3;
    private static Context g;
    private ad d;
    private af e;
    private be h;
    private aw i;
    private JSONObject j;
    private boolean l;
    private final int f = 1;
    private boolean k = false;

    public bc(Context context, be beVar) {
        this.d = ad.a(context);
        this.e = af.a(context);
        g = context;
        this.h = beVar;
        this.i = new aw(context);
        this.i.a(this.h);
    }

    public void a(JSONObject jSONObject) {
        this.j = jSONObject;
    }

    public void a(boolean z) {
        this.k = z;
    }

    public void b(boolean z) {
        this.l = z;
    }

    public void a(az azVar) {
        this.e.a(azVar);
    }

    /* JADX WARN: Unsupported multi-entry loop pattern (BACK_EDGE: B:18:0x0068 -> B:28:0x0009). Please submit an issue!!! */
    public void a() {
        try {
            if (this.j != null) {
                c();
            } else {
                b();
            }
        } catch (Throwable th) {
        }
        try {
            if (bv.k(g)) {
                SharedPreferences a2 = ba.a(g);
                if (a2 != null) {
                    String string = a2.getString(a.r, "");
                    long b2 = q.b(System.currentTimeMillis());
                    if (TextUtils.isEmpty(string)) {
                        long j = a2.getLong(a.s, -1L);
                        int i = a2.getInt(a.t, 0);
                        if (j == -1) {
                            a2.edit().putInt(a.t, i + 1).commit();
                            this.i.a();
                        } else if (b2 != j) {
                            a2.edit().putInt(a.t, 1).commit();
                            this.i.a();
                        } else if (i < 2) {
                            a2.edit().putInt(a.t, i + 1).commit();
                            this.i.a();
                        }
                        a2.edit().putLong(a.s, b2).commit();
                        return;
                    }
                    return;
                }
                this.i.a();
            }
        } catch (Throwable th2) {
        }
    }

    private void b() {
        cc.a(g).i().a(new cc.b() { // from class: com.umeng.analytics.pro.bc.1
            @Override // com.umeng.analytics.pro.cc.b
            public void a(File file) {
            }

            @Override // com.umeng.analytics.pro.cc.b
            public boolean b(File file) {
                FileInputStream fileInputStream;
                Throwable th;
                try {
                    try {
                        fileInputStream = new FileInputStream(file);
                    } catch (Exception e) {
                        return false;
                    }
                } catch (Throwable th2) {
                    th = th2;
                    fileInputStream = null;
                }
                try {
                    byte[] b2 = bw.b(fileInputStream);
                    bw.c(fileInputStream);
                    byte[] a2 = bc.this.i.a(b2);
                    return bc.this.l || (a2 == null ? 1 : bc.this.a(a2)) != 1;
                } catch (Throwable th3) {
                    th = th3;
                    bw.c(fileInputStream);
                    throw th;
                }
            }

            @Override // com.umeng.analytics.pro.cc.b
            public void c(File file) {
                bc.this.h.k();
            }
        });
    }

    private void c() {
        aa b2;
        int a2;
        try {
            this.d.a();
            try {
                String encodeToString = Base64.encodeToString(new cp().a(this.d.b()), 0);
                if (!TextUtils.isEmpty(encodeToString)) {
                    JSONObject jSONObject = this.j.getJSONObject(a.A);
                    jSONObject.put(x.O, encodeToString);
                    this.j.put(a.A, jSONObject);
                }
            } catch (Exception e) {
            }
            byte[] bytes = String.valueOf(this.j).getBytes();
            if (bytes != null && !bt.a(g, bytes)) {
                if (!this.k) {
                    b2 = aa.a(g, AnalyticsConfig.getAppkey(g), bytes);
                } else {
                    b2 = aa.b(g, AnalyticsConfig.getAppkey(g), bytes);
                }
                byte[] c2 = b2.c();
                cc.a(g).g();
                byte[] a3 = this.i.a(c2);
                if (a3 == null) {
                    a2 = 1;
                } else {
                    a2 = a(a3);
                }
                switch (a2) {
                    case 1:
                        if (!this.l) {
                            cc.a(g).a(c2);
                            return;
                        }
                        return;
                    case 2:
                        this.d.d();
                        this.h.k();
                        return;
                    case 3:
                        this.h.k();
                        return;
                    default:
                        return;
                }
            }
        } catch (Throwable th) {
        }
    }

    /* JADX INFO: Access modifiers changed from: private */
    public int a(byte[] bArr) {
        bp bpVar = new bp();
        try {
            new cj(new cy.a()).a(bpVar, bArr);
            if (bpVar.f1094a == 1) {
                this.e.b(bpVar.i());
                this.e.d();
            }
            by.c("send log:" + bpVar.f());
        } catch (Throwable th) {
        }
        return bpVar.f1094a == 1 ? 2 : 3;
    }
}
