package com.mn.kt.c.b;

import android.content.Context;
import android.database.Cursor;
import android.database.sqlite.SQLiteDatabase;
import android.os.Handler;
import android.util.Log;
import com.mn.kt.a.c;
import com.mn.kt.c.a.b;
import java.io.File;
import java.io.RandomAccessFile;
import java.util.ArrayList;
import java.util.List;
/* loaded from: classes.dex */
public final class a {

    /* renamed from: a  reason: collision with root package name */
    String f892a;
    Handler b;
    b c;
    private String e;
    private int g;
    private List h;
    private Context i;
    public int d = 1;
    private int f = 1;

    public a(String str, String str2, int i, Context context, Handler handler) {
        this.i = null;
        this.e = str;
        this.f892a = str2;
        this.b = handler;
        this.i = context;
        this.c = new b(context);
    }

    public final c a(int i, String str, int i2) {
        boolean z = true;
        int i3 = 0;
        try {
            if (!new File(this.f892a).exists()) {
                a(this.e);
            }
            Cursor rawQuery = this.c.f890a.getReadableDatabase().rawQuery("select count(*)  from download_info where url=?", new String[]{this.e});
            rawQuery.moveToFirst();
            int i4 = rawQuery.getInt(0);
            rawQuery.close();
            if (i4 != 0) {
                z = false;
            }
            if (!z) {
                this.h = this.c.a(this.e);
                Log.v("TAG", "not isFirst size=" + this.h.size());
                int i5 = 0;
                for (com.mn.kt.a.b bVar : this.h) {
                    i3 += bVar.d;
                    i5 = (bVar.c - bVar.b) + 1 + i5;
                }
                return new c(i5, i3, this.e);
            } else if (i <= 0) {
                return null;
            } else {
                try {
                    this.g = i;
                    File file = new File(this.f892a);
                    if (file.exists()) {
                        file.delete();
                    }
                    if (!file.exists()) {
                        file.createNewFile();
                    }
                    RandomAccessFile randomAccessFile = new RandomAccessFile(file, "rwd");
                    randomAccessFile.setLength(this.g);
                    randomAccessFile.close();
                } catch (Exception e) {
                    e.printStackTrace();
                }
                int i6 = this.g / this.f;
                this.h = new ArrayList();
                while (i3 < this.f - 1) {
                    this.h.add(new com.mn.kt.a.b(i3, i3 * i6, ((i3 + 1) * i6) - 1, 0, this.e, this.g, str, i2));
                    i3++;
                }
                this.h.add(new com.mn.kt.a.b(this.f - 1, (this.f - 1) * i6, this.g - 1, 0, this.e, this.g, str, i2));
                this.c.a(this.h);
                return new c(this.g, 0, this.e);
            }
        } catch (Exception e2) {
            e2.printStackTrace();
            try {
                a(this.e);
            } catch (Exception e3) {
            }
            return null;
        }
    }

    public final void a() {
        if (!(this.h == null || this.d == 2)) {
            this.d = 2;
            for (com.mn.kt.a.b bVar : this.h) {
                new b(this, this.i, bVar.f886a, bVar.b, bVar.c, bVar.d, bVar.e, bVar.f, bVar.g, bVar.h).start();
            }
        }
    }

    private void a(String str) {
        SQLiteDatabase readableDatabase = this.c.f890a.getReadableDatabase();
        readableDatabase.delete("download_info", "url=?", new String[]{str});
        readableDatabase.close();
    }
}
